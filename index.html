<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="generator" content="Crystal Docs 0.36.1">
<meta name="crystal_docs.project_version" content="master">
<meta name="crystal_docs.project_name" content="webdriver_pump">



<link href="css/style.css" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="js/doc.js"></script>

  <meta name="repository-name" content="webdriver_pump">
  <title>webdriver_pump master</title>
  <script type="text/javascript">
  CrystalDocs.base_path = "";
  </script>
</head>
<body>

<svg class="hidden">
  <symbol id="octicon-link" viewBox="0 0 16 16">
    <path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path>
  </symbol>
</svg>
<div class="sidebar">
  <div class="sidebar-header">
    <div class="search-box">
      <input type="search" class="search-input" placeholder="Search..." spellcheck="false" aria-label="Search">
    </div>

    <div class="project-summary">
      <h1 class="project-name">
        <a href="index.html">
          webdriver_pump
        </a>
      </h1>

      <span class="project-version">
        master
      </span>
    </div>
  </div>

  <div class="search-results hidden">
    <ul class="search-list"></ul>
  </div>

  <div class="types-list">
    <ul>
  
  <li class="parent " data-id="webdriver_pump/WebdriverPump" data-name="webdriverpump">
      <a href="WebdriverPump.html">WebdriverPump</a>
      
        <ul>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/Checkbox" data-name="webdriverpump::checkbox">
      <a href="WebdriverPump/Checkbox.html">Checkbox</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/CheckboxGroup" data-name="webdriverpump::checkboxgroup">
      <a href="WebdriverPump/CheckboxGroup.html">CheckboxGroup</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/ComplexFormElement" data-name="webdriverpump::complexformelement">
      <a href="WebdriverPump/ComplexFormElement.html">ComplexFormElement</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/Component" data-name="webdriverpump::component">
      <a href="WebdriverPump/Component.html">Component</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/ComponentCollection" data-name="webdriverpump::componentcollection(t)">
      <a href="WebdriverPump/ComponentCollection.html">ComponentCollection</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/ElementLocator" data-name="webdriverpump::elementlocator">
      <a href="WebdriverPump/ElementLocator.html">ElementLocator</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/ElementsLocator" data-name="webdriverpump::elementslocator">
      <a href="WebdriverPump/ElementsLocator.html">ElementsLocator</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/InvalidFormElementException" data-name="webdriverpump::invalidformelementexception">
      <a href="WebdriverPump/InvalidFormElementException.html">InvalidFormElementException</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/MultiSelectList" data-name="webdriverpump::multiselectlist">
      <a href="WebdriverPump/MultiSelectList.html">MultiSelectList</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/Page" data-name="webdriverpump::page">
      <a href="WebdriverPump/Page.html">Page</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/RadioGroup" data-name="webdriverpump::radiogroup">
      <a href="WebdriverPump/RadioGroup.html">RadioGroup</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/SelectList" data-name="webdriverpump::selectlist">
      <a href="WebdriverPump/SelectList.html">SelectList</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/SimpleFormElement" data-name="webdriverpump::simpleformelement">
      <a href="WebdriverPump/SimpleFormElement.html">SimpleFormElement</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/TextArea" data-name="webdriverpump::textarea">
      <a href="WebdriverPump/TextArea.html">TextArea</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/TextField" data-name="webdriverpump::textfield">
      <a href="WebdriverPump/TextField.html">TextField</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/TimedOutException" data-name="webdriverpump::timedoutexception">
      <a href="WebdriverPump/TimedOutException.html">TimedOutException</a>
      
    </li>
  
  <li class=" " data-id="webdriver_pump/WebdriverPump/Wait" data-name="webdriverpump::wait">
      <a href="WebdriverPump/Wait.html">Wait</a>
      
    </li>
  
</ul>

      
    </li>
  
</ul>

  </div>
</div>


<div class="main-content">
<h1><a id="webdriver-pump" class="anchor" href="#webdriver-pump">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>webdriver_pump</h1>

<p><img src="https://github.com/bwilczek/webdriver_pump/actions/workflows/spec.yml/badge.svg?branch=master" alt="Build Status"/></p>

<p>This shard is a Page Object Model lib, built on top of <a href="https://github.com/matthewmcgarvey/selenium.cr">selenium.cr</a>.
It's a crystal port of ruby's <a href="https://github.com/bwilczek/watir_pump">watir_pump</a>. Heavily inspired by <a href="https://github.com/site-prism/site_prism">SitePrism</a>.</p>

<h2><a id="installation" class="anchor" href="#installation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Installation</h2>

<ol><li>Add the dependency to your <code>shard.yml</code>:</li></ol>

<pre><code class="language-yaml">dependencies:
  webdriver_pump:
    github: bwilczek/webdriver_pump</code></pre>

<ol><li>Run <code>shards install</code></li></ol>

<h2><a id="basic-usage" class="anchor" href="#basic-usage">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Basic usage</h2>

<pre><code class="language-crystal"><span class="k">require</span> <span class="s">&quot;webdriver_pump&quot;</span>

<span class="c"># define the page model, for example:</span>
<span class="k">class</span> <span class="t">GreeterPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  url <span class="s">&quot;https://bwilczek.github.io/watir_pump_tutorial/greeter.html&quot;</span>
  element <span class="n">:header</span>, { action: <span class="n">:text</span>, locator: -> { root.find_element(<span class="n">:xpath</span>, <span class="s">&quot;//h1&quot;</span>) } }
  element <span class="n">:fill_name</span>, { action: <span class="n">:send_keys</span>, locator: {id: <span class="s">&quot;name&quot;</span>} }
  element <span class="n">:submit</span>, { action: <span class="n">:click</span>, locator: {id: <span class="s">&quot;set_name&quot;</span>} }
  element <span class="n">:greeting</span>, { action: <span class="n">:text</span>, locator: {id: <span class="s">&quot;greeting&quot;</span>} }
<span class="k">end</span>

<span class="c"># use it in specs, for example:</span>
<span class="c"># where `session` is an instance of Selenium::Session</span>
describe <span class="s">&quot;Page without components&quot;</span> <span class="k">do</span>
  it <span class="s">&quot;operates on Selenium::Elements&quot;</span> <span class="k">do</span>
    <span class="t">GreeterPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>p<span class="o">|</span>
      p.header.should eq <span class="s">&quot;Greeter app&quot;</span>
      p.fill_name <span class="s">&quot;Crystal&quot;</span>
      p.submit
      p.greeting.should eq <span class="s">&quot;Hello Crystal!&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h2><a id="documentation" class="anchor" href="#documentation">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Documentation</h2>

<p>Please refer to this chapter to learn how to define your Page Objects, and use it from your tests.</p>

<p>For complete code documentation please visit project's <a href="https://bwilczek.github.io/webdriver_pump/">GitHub Pages</a>.</p>

<h3><a id="overview" class="anchor" href="#overview">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Overview</h3>

<p><code><a href="WebdriverPump.html">WebdriverPump</a></code> provides a DSL (implemented as macros) to describe the Page Object Model.
It's a very close port of Ruby's <code>WatirPump</code> gem. There are some subtle differences in the implementation,
but the core concepts remain the same:</p>

<ul><li><strong>Nestable, reusable components</strong>, to build elegant APIs</li><li><strong>Element actions</strong>, to automatically generate simple, one liner methods (like wrappers for <code>click</code>)</li><li><strong>Page scoping</strong>, so that it's immediately known what <code>page</code> is currently being tested</li><li><strong>Form helpers</strong>, to operate HTML form elements with ease (WebDriver doesn't deliver here)</li><li><strong>Decorated collections</strong>, to access element/component collections with descriptive keys</li></ul>

<h3><a id="page" class="anchor" href="#page">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Page</h3>

<p>Describes the page under test. Inherits from <code>Component</code>, so please familiarize yourself
with that class as well to fully understand what <code>Page</code> is capable of. This section covers
only the differences from the base <code>Component</code> class.</p>

<h4><a id="url-macro" class="anchor" href="#url-macro">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>url</code> macro</h4>

<p>Declares the full URL to the page under test.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">GitHubUserPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  url <span class="s">&quot;https://github.com/bwilczek&quot;</span>
<span class="k">end</span>

describe <span class="s">&quot;Page&#39;s URL&quot;</span> <span class="k">do</span>
  it <span class="s">&quot;navigates to given URL&quot;</span> <span class="k">do</span>
    <span class="t">GitHubUserPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>p<span class="o">|</span>
      session.url.should eq <span class="s">&quot;https://github.com/bwilczek&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<p>URL can be parameterized:</p>

<pre><code class="language-crystal">class GitHubUserPage < WebdriverPump::Page
  url "https://github.com/{user}"
end

describe "Page's URL" do
  it "navigates to given parameterized URL" do
    GitHubUserPage.new(session).open(params: {user: "bwilczek"}, query: {repo: "webdriver_pump""}) do |p|
      session.url.should eq "https://github.com/bwilczek?repo=webdriver_pump"
    end
  end
end</code></pre>

<h4><a id="open" class="anchor" href="#open">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#open</code></h4>

<p>Navigates to Page's URL and executes given block in the scope of the page.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">GitHubUserPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  url <span class="s">&quot;https://github.com/bwilczek&quot;</span>
  element <span class="n">:user_nickname</span>, { locator: { xpath:, <span class="s">&quot;//span[@itemprop=&#39;additionalName&#39;]&quot;</span>) } }
<span class="k">end</span>

describe <span class="s">&quot;Page&#39;s URL&quot;</span> <span class="k">do</span>
  it <span class="s">&quot;navigates to given URL&quot;</span> <span class="k">do</span>
    <span class="t">GitHubUserPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>page<span class="o">|</span>
      page.<span class="k">class</span>.should eq <span class="t">GitHubUserPage</span>
      page.user_nickname.<span class="k">class</span>.should eq <span class="t">Selenium</span><span class="t">::</span><span class="t">Element</span>
      page.user_nickname.text.should eq <span class="s">&quot;bwilczek&quot;</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h4><a id="use" class="anchor" href="#use">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#use</code></h4>

<p>Similar to <code>#open</code>, but does not perform the navigation - assumes that the page is already open.
Useful when the navigation is triggered by an action on a different page.</p>

<pre><code class="language-crystal"><span class="t">GitHubUserPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> { <span class="o">|</span>p<span class="o">|</span> p.navigate_to_repo(<span class="s">&quot;webdriver_pump&quot;</span>) }

<span class="t">GitHubRepoPage</span>.<span class="k">new</span>(session).use <span class="k">do</span> <span class="o">|</span>p<span class="o">|</span>
  p.<span class="k">class</span>.should eq <span class="t">GitHubRepoPage</span>
<span class="k">end</span></code></pre>

<h4><a id="loaded" class="anchor" href="#loaded">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#loaded?</code></h4>

<p>Predicate method denoting if page is ready to be interacted with.</p>

<p>In most cases creation of this method will not be required, since <code>WebDriver</code> itself
checks if page's resources have been loaded. Only in case of more complex pages,
that heavily rely on parts loaded dynamically over XHR providing of custom <code>loaded?</code>
criteria might be necessary.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">GitHubUserPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  url <span class="s">&quot;https://js-heavy.com&quot;</span>
  element <span class="n">:created_by_xhr</span>, { locator: {id: <span class="s">&quot;content&quot;</span>} }

  <span class="k">def</span> <span class="m">loaded?</span>
    created_by_xhr.displayed?
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h3><a id="component" class="anchor" href="#component">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Component</h3>

<p>Components are the foundation of <code><a href="WebdriverPump.html">WebdriverPump</a></code> models.
They abstract out certain sub-trees of the page's DOM tree into <code>crystal</code> classes
and hide the underlying HTML behind the business oriented API.</p>

<p><code>Pages</code> are the top-level components, that abstract out the complete page (DOM sub-tree starting at <code>//body</code>).</p>

<p>Components can be nested, and grouped into collections.</p>

<p>They are declared inside their parent components using <code>element</code> macro, with a <code>class</code> parameter, that refers to <code>crystal</code> class, a child  of <code><a href="WebdriverPump/Component.html">WebdriverPump::Component</a></code> (NOT a CSS class).</p>

<h4><a id="initialize-constructor" class="anchor" href="#initialize-constructor">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#initialize</code> (constructor)</h4>

<p>Usually invoked implicitly by the <code>element(s)</code> macro.</p>

<p>Accepts two parameters:</p>

<ul><li><code>@session : Selenium::Session</code></li><li><code>@root : Selenium::Element</code></li></ul>

<p>Example of explicit usage:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">OrderItemDetails</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Component</span>
  <span class="c"># omitted for brevity</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">OrderPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  <span class="c"># omitted for brevity</span>

  <span class="k">def</span> <span class="o">[]</span>(name)
    node <span class="o">=</span> root.find_element(<span class="n">:xpath</span>, <span class="s">&quot;.//div[@class=&#39;item&#39; and contains(text(), &#39;</span><span class="i">#{</span>name<span class="i">}</span><span class="s">&#39;)]&quot;</span>)
    <span class="t">OrderItemDetails</span>.<span class="k">new</span>(session, node)
  <span class="k">end</span>
<span class="k">end</span>

<span class="t">OrderPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>order<span class="o">|</span>
  order[<span class="s">&quot;Rubber hammer, 2kg&quot;</span>].<span class="k">class</span>.should eq <span class="t">OrderItemDetails</span>
<span class="k">end</span></code></pre>

<h4><a id="session" class="anchor" href="#session">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#session</code></h4>

<p>Reference to associated <code>Selenium::Session</code> instance.</p>

<h4><a id="root" class="anchor" href="#root">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#root</code></h4>

<p>Mounting point of current component in the DOM tree. Type: <code>Selenium::Element</code>.</p>

<p>For <code>Pages</code> it points to <code>//body</code>.</p>

<h4><a id="wait" class="anchor" href="#wait">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>#wait</code></h4>

<p>Reference to <code><a href="WebdriverPump/Wait.html">WebdriverPump::Wait</a></code> module. Usage:</p>

<pre><code class="language-crystal"><span class="c"># with default settings</span>
wait.<span class="k">until</span> { condition_is_met }

<span class="c"># with custom settings</span>
wait.<span class="k">until</span>(timeout: <span class="n">19</span>, interval: <span class="n">0.3</span>) { other_condition_is_met }

<span class="c"># global config (optional)</span>
<span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Wait</span>.timeout <span class="o">=</span> <span class="n">10</span>    <span class="c"># default = 15</span>
<span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Wait</span>.interval <span class="o">=</span> <span class="n">0.5</span>  <span class="c"># default = 0.2</span></code></pre>

<h4><a id="element-macro" class="anchor" href="#element-macro">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>element</code> macro</h4>

<p>A DSL macro to declare <code>Element</code>s located inside given component.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">MyPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  url <span class="s">&quot;http://example.org&quot;</span>

  <span class="c"># synopsis:</span>
  <span class="c"># element :name : Symbol, params : NamedTuple</span>

  <span class="c"># examples</span>
  <span class="c"># locate and return Selenium::Element</span>
  element <span class="n">:title1</span>, { locator: {xpath: <span class="s">&quot;.//div[@role=&#39;title&#39;]&quot;</span>} }
  <span class="c"># equivalent of:</span>
  <span class="k">def</span> <span class="m">title1</span>
    root.find_element(<span class="n">:xpath</span>, <span class="s">&quot;.//div[@role=&#39;title&#39;]&quot;</span>)
  <span class="k">end</span>

  <span class="c"># locate Selenium::Element and perform action (invoke method) on it at once</span>
  element <span class="n">:title2</span>, { locator: {xpath: <span class="s">&quot;.//div[@role=&#39;title&#39;]&quot;</span>}, action: <span class="n">:text</span> }
  <span class="c"># equivalent of:</span>
  <span class="k">def</span> <span class="m">title2</span>
    root.find_element(<span class="n">:xpath</span>, <span class="s">&quot;.//div[@role=&#39;title&#39;]&quot;</span>).text
  <span class="k">end</span>

  <span class="c"># locate Selenium::Element and use it as a mounting point for another component</span>
  element <span class="n">:title3</span>, { locator: {xpath: <span class="s">&quot;.//div[@class=&#39;user_details&#39;]&quot;</span>}, <span class="k">class</span>: <span class="t">UserDetails</span> }
  <span class="c"># equivalent of:</span>
  <span class="k">def</span> <span class="m">title3</span>
    node <span class="o">=</span> root.find_element(<span class="n">:xpath</span>, <span class="s">&quot;.//div[@role=&#39;title&#39;]&quot;</span>)
    <span class="t">UserDetails</span>.<span class="k">new</span>(session, node)
  <span class="k">end</span>
<span class="k">end</span></code></pre>

<h5><a id="locator" class="anchor" href="#locator">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>locator</h5>

<p>Required parameter. Locator of the <code>Element</code> in the DOM tree. Allowed formats are:</p>

<ul><li>1 element <code>NamedTuple</code> with key in (<code>:id</code>, <code>:name</code>, <code>:tag_name</code>, <code>:class_name</code>, <code>:css</code>, <code>:link_text</code>, <code>:partial_link_text</code>, <code>:xpath</code>), and a respective value.</li><li>a <code>Proc</code> returning <code>Element</code>, e.g. <code>-> { root.find_element(:id, "user") }</code>, <code>-> { some_wrapper_element.find_element(:id, "user") }</code></li></ul>

<h5><a id="action" class="anchor" href="#action">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>action</h5>

<p><code>Symbol</code>, name of <code>Element</code>s method to be executed.</p>

<h5><a id="class" class="anchor" href="#class">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>class</h5>

<p><code>Component</code> class. If provided the <code>Element</code> located using <code>locator</code> will be the mounting point for the component of given class.</p>

<h4><a id="elements-macro" class="anchor" href="#elements-macro">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a><code>elements</code> macro</h4>

<p>A DSL macro to declare a collection of <code>Element</code>s inside given component.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">CollectionIndexedByName</span>(<span class="t">T</span>) <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">ComponentCollection</span>(<span class="t">T</span>)
  <span class="k">def</span> <span class="o">[]</span>(name)
    ret <span class="o">=</span> find { <span class="o">|</span>el<span class="o">|</span> el.name <span class="o">==</span> name }
    raise <span class="s">&quot;Component with name=&#39;</span><span class="i">#{</span>name<span class="i">}</span><span class="s">&#39; not found&quot;</span> <span class="k">unless</span> ret
    ret
  <span class="k">end</span>
<span class="k">end</span>

<span class="k">class</span> <span class="t">OrderItem</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Component</span>
  element <span class="n">:name</span>, { action: <span class="n">:text</span>, locator: {css: <span class="s">&quot;.name&quot;</span>} }
<span class="k">end</span>

<span class="k">class</span> <span class="t">OrderPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  elements <span class="n">:raw_order_items</span>, { locator: {xpath: <span class="s">&quot;.//li&quot;</span>} }

  elements <span class="n">:order_items</span>, {
    locator: {xpath: <span class="s">&quot;.//li&quot;</span>},
    <span class="k">class</span>: <span class="t">OrderItem</span>,
    collection_class: <span class="t">CollectionIndexedByName</span>(<span class="t">OrderItem</span>)
  }
<span class="k">end</span>

<span class="t">OrderPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>page<span class="o">|</span>
  page.raw_order_items.<span class="k">class</span>.should eq <span class="t">Array</span>(<span class="t">Selenium</span><span class="t">::</span><span class="t">Element</span>)
  page.raw_order_items[<span class="n">0</span>].<span class="k">class</span>.should eq <span class="t">Selenium</span><span class="t">::</span><span class="t">Element</span>

  page.order_items.<span class="k">class</span>.should eq <span class="t">CollectionIndexedByName</span>(<span class="t">OrderItem</span>)
  page.order_items[<span class="s">&quot;Rubber hammer, 2kg&quot;</span>].should eq <span class="t">OrderItem</span>
<span class="k">end</span></code></pre>

<h5><a id="locator" class="anchor" href="#locator">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>locator</h5>

<p>Required parameter. Same rules as for <code>element</code> macro, but returns <code>Array(Element)</code>.</p>

<h5><a id="class" class="anchor" href="#class">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>class</h5>

<p>Optional <code>Component</code> class to wrap each of the collection's elements.</p>

<h5><a id="collection-class" class="anchor" href="#collection-class">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>collection_class</h5>

<p>Optional <code>ComponentCollection</code> class to wrap the whole collection. Useful to introduce more descriptive ways of accessing elements.</p>

<h4><a id="form-helper-macros" class="anchor" href="#form-helper-macros">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Form helper macros</h4>

<p><code>WebDriver</code> API itself does not provide methods to easily set and get values of HTML form elements.
This is where <code><a href="WebdriverPump.html">WebdriverPump</a></code>'s form helper macros come handy.</p>

<h5><a id="form-element" class="anchor" href="#form-element">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>form_element</h5>

<p>A macro that generates getter and setter methods for common HTML form elements.</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">LoginPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  form_element <span class="n">:username</span>, { <span class="k">class</span>: <span class="t">TextField</span>, locator: {name: <span class="s">&quot;username&quot;</span>} }

  <span class="c"># iis equivalent of:</span>
  <span class="k">def</span> <span class="m">username</span>
    <span class="c"># some logic that gets the value of given TextField</span>
  <span class="k">end</span>

  <span class="k">def</span> <span class="m">username</span><span class="o">=</span>(val)
    <span class="c"># some logic that sets the value of given TextField to val</span>
  <span class="k">end</span>
<span class="k">end</span>

<span class="t">LoginPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>page<span class="o">|</span>
  page.username <span class="o">=</span> <span class="s">&quot;Bob&quot;</span>
  page.username.should eq <span class="s">&quot;Bob&quot;</span>
<span class="k">end</span></code></pre>

<p>The supported form elements are:</p>

<p>| FormElement     | expected locator | value type    | value                                 |
|-----------------|------------------|---------------|---------------------------------------|
| TextField       | ElementLocator   | String        | content of the input field            |
| TextArea        | ElementLocator   | String        | content of the text area              |  
| RadioGroup      | ElementsLocator  | String        | label of the checked input element    |
| CheckboxGroup   | ElementsLocator  | Array(String) | labels of the checked input elements  |
| Checkbox        | ElementLocator   | Bool          | label of the checked input element    |
| SelectList      | ElementLocator   | String        | label of the selected option element  |
| MultiSelectList | ElementLocator   | Array(String) | labels of the checked option elements |</p>

<p>Please bear in mind that some of them require a locator for a single DOM node (e.g. <code>TextField</code> for a <code><input type="text" ...></code>),
while other ones require a locator for multiple DOM nodes, that consist the form element (e.g. <code>CheckboxGroup</code> for a collection of <code><input type="checkbox" name="countries[] ..."></code>).</p>

<h5><a id="fill-form" class="anchor" href="#fill-form">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>fill_form</h5>

<p>This macro acts as a wrapper for calling multiple <code>form_element</code> setters at once.</p>

<p>Let's consider the following example:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">LoginPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  form_element <span class="n">:username</span>, { <span class="k">class</span>: <span class="t">TextField</span>, locator: {name: <span class="s">&quot;username&quot;</span>} }
  form_element <span class="n">:password</span>, { <span class="k">class</span>: <span class="t">TextField</span>, locator: {name: <span class="s">&quot;password&quot;</span>} }
  element <span class="n">:submit_form</span>, { locator: {id: <span class="s">&quot;submit&quot;</span>}, action: <span class="n">:click</span> }

  fill_form <span class="n">:login</span>, { submit: <span class="n">:submit_form</span>, fields: [<span class="n">:username</span>, <span class="n">:password</span>] }
  <span class="c"># equivalent of:</span>
  <span class="k">def</span> <span class="m">login</span>(params)
    <span class="k">self</span>.username <span class="o">=</span> params[<span class="n">:username</span>]
    <span class="k">self</span>.password <span class="o">=</span> params[<span class="n">:password</span>]
    submit_form
  <span class="k">end</span>
<span class="k">end</span>

<span class="c"># Usage:</span>
<span class="t">LoginPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>page<span class="o">|</span>
  page.login(username: <span class="s">&quot;bob&quot;</span>, password: <span class="s">&quot;secret&quot;</span>)
<span class="k">end</span></code></pre>

<p><code>fill_form</code> macro expects the following parameters:</p>

<ul><li><code>Symbol</code> name of the method to be generated</li><li><code>NamedTuple</code> with the following parameters</li><ul><li><code>fields</code> - (required) <code>Array(Symbol)</code> - list of setters to be invoked</li><li><code>submit</code> - (optional) <code>Symbol</code> - name of the method to be executed after all setters</li></ul></ul>

<h5><a id="form-data" class="anchor" href="#form-data">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>form_data</h5>

<p>This macro acts as a wrapper for calling multiple <code>form_element</code> getters at once.
It returns a <code>NamedTuple</code> with keys being the getter method names, and values the results that they return.</p>

<p>Let's consider the following example:</p>

<pre><code class="language-crystal"><span class="k">class</span> <span class="t">SummaryPage</span> <span class="o">&lt;</span> <span class="t">WebdriverPump</span><span class="t">::</span><span class="t">Page</span>
  form_element <span class="n">:title</span>, { <span class="k">class</span>: <span class="t">TextField</span>, locator: {name: <span class="s">&quot;title&quot;</span>} }

  <span class="c"># form_data doesn&#39;t require `form_element`s - it will work with all instance methods that don&#39;t require arguments</span>
  element <span class="n">:header</span> { locator: {xpath: <span class="s">&quot;../h1&quot;</span>}, action: <span class="n">:text</span> }

  form_data <span class="n">:summary</span>, { fields: [<span class="n">:title</span>, <span class="n">:header</span>] }
  <span class="c"># equivalent of:</span>
  <span class="k">def</span> <span class="m">summary</span>
    {
      title: <span class="k">self</span>.title,
      header: <span class="k">self</span>.header
    }
  <span class="k">end</span>
<span class="k">end</span>

<span class="c"># Usage:</span>
<span class="t">SummaryPage</span>.<span class="k">new</span>(session).open <span class="k">do</span> <span class="o">|</span>page<span class="o">|</span>
  summary <span class="o">=</span> page.summary
  summary[<span class="n">:title</span>].should eq page.title
  summary[<span class="n">:header</span>].should eq page.header
<span class="k">end</span></code></pre>

<p><code>form_data</code> macro expects the following parameters:</p>

<ul><li><code>Symbol</code> name of the method to be generated</li><li><code>NamedTuple</code> with the following parameters</li><ul><li><code>fields</code> - (required) Array(Symbol) - list of methods to be invoked and their results returned</li></ul></ul>

<h2><a id="development-roadmap" class="anchor" href="#development-roadmap">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Development roadmap</h2>

<ul><li>[x] Page without Components</li><li>[x] Declare raw WebDriver elements with webdriver locators</li><li>[x] Declare raw WebDriver elements with lambdas</li><li>[x] Declare actions on WebDriver elements</li><li>[x] Declare reusable Components</li><li>[x] Collections of elements</li><li>[x] Collections of Components</li><li>[x] Nest Components</li><li>[x] Wait for AJAX-driven Components to be ready to interact</li><li>[x] ComponentCollection class</li><li>[x] Fill in complex forms: RadioGroups, SelectLists</li><li>[x] Parametrize Page url</li><li>[x] Support <code>loaded?</code> predicate for Pages</li><li>[x] Port WatirPump's form helpers</li><li>[ ] Form helper for file upload (?)</li><li>[x] Introduce Exception classes</li><li>[x] Update README</li><li>[ ] Update code documentation</li></ul>

<h2><a id="contributing" class="anchor" href="#contributing">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributing</h2>

<ol><li>Fork it (&lt;https://github.com/bwilczek/webdriver_pump/fork>)</li><li>Create your feature branch (<code>git checkout -b my-new-feature</code>)</li><li>Test your changes, add relevant specs</li><li>Commit your changes (<code>git commit -am 'Add some feature'</code>)</li><li>Push to the branch (<code>git push origin my-new-feature</code>)</li><li>Create a new Pull Request</li></ol>

<h2><a id="contributors" class="anchor" href="#contributors">
  <svg class="octicon-link" aria-hidden="true">
    <use href="#octicon-link"/>
  </svg>
</a>Contributors</h2>

<ul><li><a href="https://github.com/bwilczek">Bartek Wilczek</a> - creator and maintainer</li></ul>
</div>
</body>
</html>
